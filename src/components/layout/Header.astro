---
import { getEntry } from 'astro:content';

interface Props {
  lang: 'de' | 'en';
}

const { lang } = Astro.props;
const globalData = await getEntry('global', lang);

const currentPath = Astro.url.pathname;
const otherLang = lang === 'de' ? 'en' : 'de';
const currentPathWithoutLang = Astro.url.pathname.replace(/^\/woic\/(de|en)/, '');
const switchUrl = `/woic/${otherLang}${currentPathWithoutLang || '/'}`;
---

<header class="bg-white dark:bg-neutral-900 shadow-sm border-b border-neutral-200 dark:border-neutral-700">
  <div class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      <!-- Church Name/Logo -->
      <div class="flex items-center space-x-3">
        <img
          src={globalData.data.organization.logo}
          alt="Church Logo"
          class="h-10 w-auto"
          width="40"
          height="40"
        />
        <h1 class="text-xl font-bold text-neutral-900 dark:text-neutral-100">
          {globalData.data.site.name}
        </h1>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center space-x-6">
        {globalData.data.navigation.map((item) => (
          <a
            href={item.href}
            class={`text-sm font-medium transition-colors ${
              currentPath === item.href || currentPath.startsWith(item.href + '/')
                ? 'text-primary-600 dark:text-primary-400'
                : 'text-neutral-700 dark:text-neutral-300 hover:text-primary-600 dark:hover:text-primary-400'
            }`}
          >
            {item.label}
          </a>
        ))}
      </nav>

      <!-- Mobile Menu Button -->
      <button
        type="button"
        class="md:hidden p-2 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-lg transition-colors"
        aria-label="Toggle menu"
        id="mobile-menu-button"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

      <!-- Language Switcher -->
      <div class="hidden md:flex items-center">
        <a
          href={switchUrl}
          class="flex items-center space-x-1 px-3 py-1.5 rounded-lg text-sm font-medium bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors"
          aria-label={lang === 'de' ? 'Switch to English' : 'Auf Deutsch wechseln'}
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
          </svg>
          <span class="uppercase">{otherLang}</span>
        </a>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden md:hidden border-t border-neutral-200 dark:border-neutral-700">
      <nav class="px-4 py-4 space-y-2">
        {globalData.data.navigation.map((item) => (
          <a
            href={item.href}
            class={`block py-2 px-3 rounded-lg text-sm font-medium transition-colors ${
              currentPath === item.href || currentPath.startsWith(item.href + '/')
                ? 'bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400'
                : 'text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800'
            }`}
          >
            {item.label}
          </a>
        ))}
        <!-- Mobile Language Switcher -->
        <div class="border-t border-neutral-200 dark:border-neutral-700 pt-3 mt-2">
          <a
            href={switchUrl}
            class="flex items-center space-x-2 py-2 px-3 rounded-lg text-sm font-medium bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors"
            aria-label={lang === 'de' ? 'Switch to English' : 'Auf Deutsch wechseln'}
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
            </svg>
            <span class="uppercase">{otherLang}</span>
            <span>â€” {lang === 'de' ? 'Switch to English' : 'Auf Deutsch wechseln'}</span>
          </a>
        </div>
      </nav>
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');

  button?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
</script>
