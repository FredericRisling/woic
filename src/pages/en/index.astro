---
import { getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import Hero from '../../components/ui/Hero.astro';
import Section from '../../components/ui/Section.astro';
import Card from '../../components/ui/Card.astro';
import Button from '../../components/ui/Button.astro';
import InstagramEmbed from '../../components/ui/InstagramEmbed.astro';

const lang = 'en';
const pageData = await getEntry('pages', `${lang}/index`);
---

<BaseLayout
  title={pageData.data.meta.title}
  description={pageData.data.meta.description}
  lang={lang}
>
  <Header slot="default-header" lang={lang} />

  {pageData.data.hero && (
    <Hero
      title={pageData.data.hero.title}
      subtitle={pageData.data.hero.subtitle}
      image={pageData.data.hero.image}
    >
      {pageData.data.hero.buttons && (
        <div class="flex gap-4 justify-center">
          {pageData.data.hero.buttons.map(btn => (
            <Button
              href={btn.href}
              variant={btn.variant}
              class={btn.className}
            >
              {btn.label}
            </Button>
          ))}
        </div>
      )}
    </Hero>
  )}

  {pageData.data.sections.map(section => {
    if (section.type === 'cards') {
      return (
        <Section
          title={section.title}
          subtitle={section.subtitle}
          background={section.background}
        >
          <div class="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
            {section.cards?.map(card => (
              <Card>
                <h3 class="text-xl font-bold mb-3 text-neutral-900 dark:text-neutral-100">
                  {card.title}
                </h3>
                <p class="text-neutral-600 dark:text-neutral-400 mb-4">
                  {card.description}
                </p>
                {card.button && (
                  <Button href={card.button.href} variant="primary" class="w-full">
                    {card.button.label}
                  </Button>
                )}
              </Card>
            ))}
          </div>
        </Section>
      );
    }

    if (section.type === 'announcement') {
      return (
        <Section background={section.background} title={section.title}>
          <div class="max-w-3xl mx-auto">
            {section.announcement && (
              <div class="bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800 rounded-2xl p-8 mb-8 text-center">
                <span class="inline-block px-3 py-1 bg-primary-600 text-white text-sm font-bold rounded-full mb-4">
                  {section.announcement.badge}
                </span>
                <p class="text-sm font-semibold text-primary-600 dark:text-primary-400 uppercase tracking-wider mb-2">
                  {section.announcement.heading}
                </p>
                <h3 class="text-2xl md:text-3xl font-bold text-neutral-900 dark:text-neutral-100 mb-3">
                  {section.announcement.text}
                </h3>
                <p class="text-neutral-600 dark:text-neutral-400">
                  {section.announcement.description}
                </p>
              </div>
            )}
            <div class="text-center">
              <p class="text-lg text-neutral-600 dark:text-neutral-400 mb-6">
                {section.cta?.text}
              </p>
              {section.cta?.button && (
                <Button href={section.cta.button.href} variant="primary">
                  {section.cta.button.label}
                </Button>
              )}
            </div>
          </div>
        </Section>
      );
    }

    if (section.type === 'cta') {
      return (
        <Section background={section.background} title={section.title}>
          <div class="max-w-3xl mx-auto text-center">
            <p class="text-lg text-neutral-600 dark:text-neutral-400 mb-6">
              {section.cta?.text}
            </p>
            {section.cta?.button && (
              <Button href={section.cta.button.href} variant="primary">
                {section.cta.button.label}
              </Button>
            )}
          </div>
        </Section>
      );
    }

    if (section.type === 'instagram') {
      return (
        <Section
          title={section.title}
          subtitle={section.subtitle}
          background={section.background}
        >
          {section.instagram && (
            <InstagramEmbed
              posts={section.instagram.posts}
              consentMessage={section.instagram.consent.message}
              consentButtonLabel={section.instagram.consent.buttonLabel}
              privacyLink={section.instagram.consent.privacyLink}
              privacyLinkText={section.instagram.consent.privacyLinkText}
            />
          )}
        </Section>
      );
    }
  })}

  <Footer slot="default-footer" lang={lang} />
</BaseLayout>
